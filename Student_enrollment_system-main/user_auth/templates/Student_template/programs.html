{% extends 'Student_template/header.html' %}
{% load static %}

<link rel="stylesheet" href="https://cdn.datatables.net/1.13.3/css/jquery.dataTables.min.css" />
      
<!-- jQuery library file -->
<script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.js">
</script>
{% block content %}
<div class="content-page">
    <div class="content">
        <div class="d-flex justify-content-end mb-3">
            {% comment %} <a href="javascript:;" data-toggle="reload" data-bs-toggle="modal"
                            data-bs-target="#programModal"><i class="fas fa-plus"></i></a> {% endcomment %}

            <button type="button" class="btn btn-blue" data-bs-toggle="modal" data-bs-target="#programModal">
                <i class="fas fa-plus"></i>
            </button>
            <div class="ms-3">
                <input type="text" class="form-control" placeholder="Search">
            </div>
        </div>
        <div class="col-xl-12">
            <div class="card">
                <div class="card-body">
                    <h4 class="header-title mb-0">Programs</h4>

                    <div id="cardCollpase5" class="collapse pt-3 show">
                        <div class="table-responsive">
                            <table id ="program_table" class="table table-hover table-centered mb-0">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Program Name</th>
                                        <!-- <th>Total student</th> -->
                                        <th>Action</th>
                                    </tr>
                                </thead>

                                <tbody>
                                </tbody>
                            </table>
                        </div> <!-- end table responsive-->
                    </div> <!-- collapsed end -->
                </div> <!-- end card-body -->
            </div> <!-- end card-->
        </div> 
        <!-- end col-->
    </div>
    <!-- end content -->

    <div class="modal fade" id="myprogramModal">
        <div class="modal-dialog">
            <div class="modal-content" style="top: 155px;">

                <!-- Modal Header -->
                <form id="delet_users">
                    <div class="modal-header">
                        <h4 class="modal-title">Delete Program</h4>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>

                    <!-- Modal body -->
                    <div class="modal-body">
                        Are you sure you want to Delete this Program ?
                    </div>


                    <!-- Modal footer -->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
                        <!-- <button type="submit" onclick="submit"  class="btn btn-danger" data-dismiss="modal">Delete</button> -->
                        <button type="submit" class="btn btn-danger" id="program_del" data-dismiss="modal">Delete</button>
                    </div>
                </form>

            </div>
        </div>
    </div>

    <div class="modal fade" id="programModal" tabindex="-1" role="dialog" aria-labelledby="programModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="programModalLabel">Create Program</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form method="post" id="program-form">
                      <div class="mb-3">
                        <label for="program_name" class="form-label">Program Name</label>
                        <input type="text" class="form-control" id="program_name" name="program_name" placeholder="Enter program name">
                      </div>
                      <div class="mb-3">
                        <label for="program_abb" class="form-label">Program Abbreviation</label>
                        <input type="text" class="form-control" id="program_abb" name="program_abb" placeholder="Enter program abbreviation">
                      </div>
                      <button type="submit" class="btn btn-primary">Create</button>
                    </form>
                  </div>
                </div>
              </div>
            </div>


{% comment %} {% extends 'Student_template/header.html' %}
{% load static %}

<link rel="stylesheet" href="https://cdn.datatables.net/1.13.3/css/jquery.dataTables.min.css" />
      
<!-- jQuery library file -->
<script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.js">
</script>
{% block content %}
<div class="content-page">
    <div class="content">
<div class="col-xl-12">
    <div class="card">
        <div class="card-body">
            <h4 class="header-title mb-0">Programs</h4>
            
            

            <div id="cardCollpase5" class="collapse pt-3 show">
                <div class="table-responsive">
                    <table id ="program_table" class="table table-hover table-centered mb-0">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Program Name</th>
                                <!-- <th>Total student</th> -->
                                <th>Action</th>
                            </tr>
                        </thead>

                        <tbody>
                        </tbody>
                    </table>
                </div> <!-- end table responsive-->
            </div> <!-- collapsed end -->
        </div> <!-- end card-body -->
    </div> <!-- end card-->
    
</div> 
<!-- end col-->


<!-- end col-->
</div>
<div class="modal fade" id="myprogramModal">
    <div class="modal-dialog">
        <div class="modal-content" style="top: 155px;">

            <!-- Modal Header -->
            <form id="delet_users">
                <div class="modal-header">
                    <h4 class="modal-title">Delete Program</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <!-- Modal body -->
                <div class="modal-body">
                    Are you sure you want to Delete this Program ?
                </div>


                <!-- Modal footer -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
                    <!-- <button type="submit" onclick="submit"  class="btn btn-danger" data-dismiss="modal">Delete</button> -->
                    <button type="submit" class="btn btn-danger" id="program_del" data-dismiss="modal">Delete</button>
                </div>
            </form>

        </div>
    </div>
</div>
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#programModal">
    Create Program
  </button>
  
  <div class="modal fade" id="programModal" tabindex="-1" role="dialog" aria-labelledby="programModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="programModalLabel">Create Program</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form method="post" id="program-form">
            <div class="mb-3">
              <label for="program_name" class="form-label">Program Name</label>
              <input type="text" class="form-control" id="program_name" name="program_name" placeholder="Enter program name">
            </div>
            <div class="mb-3">
              <label for="program_abb" class="form-label">Program Abbreviation</label>
              <input type="text" class="form-control" id="program_abb" name="program_abb" placeholder="Enter program abbreviation">
            </div>
            <button type="submit" class="btn btn-primary">Create</button>
          </form>
        </div>
      </div>
    </div>
  </div>
   {% endcomment %}

 <!--End The user DELETE Modal -->


{% include 'Student_template/footer.html' %}
{% block extra_js%}
<script>
    
        $(document).ready(function() {
          $('#program-form').submit(function(e) {
            e.preventDefault();
            var programName = $('#program_name').val();
            var programAbb = $('#program_abb').val();
            var token = localStorage.getItem('token');
            var data = {
              'program_name': programName,
              'program_abb': programAbb,
            };
            $.ajax({
              type: 'POST',
              url: '{% url "create_program" %}',
              headers: {
                'Authorization': 'Token ' + token
              },
              contentType: 'application/json',
              data: JSON.stringify(data),
              success: function(response) {
                console.log(response);
                $('#programModal').modal('hide');
                alert('Program created successfully!');
                location.reload();
              },
              error: function(error) {
                console.log(error);
                alert('An error occurred while creating program. Please try again later.');
              }
            });
          });
        });
        
        
    function getToken() {
    // This function should return the user token dynamically
    return (localStorage.getItem('token'));
}

$("document").ready(function () {
    var table = $('#program_table').DataTable({
        "ajax": {
            url: "{% url 'create_program' %}",
            type: "GET",
            contentType: "application/json",
            headers: { "Authorization": `token ${getToken()}` },
            dataSrc: function (res) {
                return res;
            }
        },
        "columns": [
            { "data": "id" },
            { "data": "program_name" },
            {
                "data": null,
                "render": function (data, type, row) {
                    var html = '<a href="#" onclick="ViewprogramStudent(\'' + row.id + '\', \'' + row.program_name + '\')"><i class="fas fa-eye"></i></a>';
                    html += ' <a href="#" onclick="blockdeleteItem(\'' + row.id + '\')" data-bs-toggle="modal" data-bs-target="#myprogramModal"><i class="fas fa-trash-alt"></i></a>';
                    return html;
                }
            }
        ]
    });
});


// <a href="javascript:;"data-toggle="reload" onclick="FetchblockDetails(${item.id});" data-bs-toggle="modal" data-bs-target="#block_edit"><i class="fas fa-edit"></i></a>

// eye view page
function getToken() {
    // This function should return the user token dynamically
    return (localStorage.getItem('token'));
}

// function ViewblockStudent(itemId) {
//     window.location.href = '/block_student_view'
//     localStorage.setItem('x', itemId);
//     localStorage.setItem('y', itemblockname);

// }

function ViewprogramStudent(itemId , Itemname) {
    window.location.href = '/program_student_view';
    localStorage.setItem('x', itemId);
localStorage.setItem('program_name', Itemname);


}
function blockdeleteItem(itemId) {


    $.ajax({
        url: "http://127.0.0.1:8000/program/" + itemId + '/',
        method: "GET",
        headers: { "Authorization": `token ${getToken()}` },
        success: function (data) {

            // Remove item from the HTML table
            var userid = data.id;
            console.log(userid)


        },
    });

$('#program_del').click(function () {
    // Send an AJAX request to delete the user
    $.ajax({
        url: "http://127.0.0.1:8000/program/" + itemId + '/',
        method: "DELETE",
        headers: { "Authorization": `token ${getToken()}` },
        success: function (data) {
            // Reload the page after successful deletion
            window.location.reload();
        },
    });
});
}
</script>
{% endblock extra_js %}
{%  endblock %}